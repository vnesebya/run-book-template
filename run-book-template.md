# Run Book / Руководство по эксплуатации системы

См. [`README.md`](README.md) для получения подробной информации о том, как использовать этот шаблон ** Run Book / Руководство по эксплуатации системы **.

Copyright © 2014-2016 [Скелтон Тэтчер Консалтинг] (https://skeltonthatcher.com/)

Лицензировано в соответствии с [CC BY-SA 4.0] (https://creativecommons.org/licenses/by-sa/4.0/)! [CC BY-SA 4.0] (https://licensebuttons.net/l/by-sa/). 3,0 / 88x31.png)


## Сервис или обзор системы

** Сервис или название системы: **

### Обзор деятельности

> Какая бизнес-потребность удовлетворяется этой службой или системой? Какие ожидания у нас есть в отношении доступности и производительности?

_ (например, обеспечивает надежную автоматическую сверку логистических операций за предыдущие 24 часа) _

### Технический обзор

> Что это за система? Интернет-обработка заказов? Бэк-энд пакетная система? Внутренний HTTP-интерфейс API? Система управления ETL?

_ (например, внутренний API для согласования заказов на основе Ruby и RabbitMQ, развернутый в контейнерах Docker в Kubernetes) _

### Соглашения об уровне обслуживания (SLA)

> Каковы явные или неявные ожидания от пользователей или клиентов в отношении доступности услуги или системы?

_ (например, договорная 99,9% доступность обслуживания за пределами окна обслуживания 03:00-05:00) _

### Владелец сервиса

> Какая команда владеет и управляет этим сервисом или системой?

_ (например, команда * Sneaky Sharks * (Бангалор) разрабатывает и запускает этот сервис: sneaky.sharks@company.com / * # sneaky-sharks * в Slack / Extension 9265) _

### Вклад приложений, демонов, сервисов, промежуточного программного обеспечения

> Какие отдельные программные приложения, демоны, сервисы и т. Д. Составляют сервис или систему? Какие внешние зависимости у него есть?

_ (например, приложение Ruby + RabbitMQ для исходных сообщений + PostgreSQL для согласованных транзакций) _

## Характеристики системы

### Часы работы

> В какие часы на самом деле должна работать служба или система? Могут ли части или функции системы быть недоступными в случае необходимости?

#### Часы работы - основные функции

_ (например, 03:00-01:00 GMT+0) _

#### Часы работы - второстепенные характеристики

_ (например, 07:00-23:00 GMT+0) _

### Потоки данных и обработки

> Как и где данные проходят через систему? Что контролирует или запускает потоки данных?

_ (например, мобильные запросы / запланированные пакетные задания / входящие данные датчика IoT) _

### Инфраструктура и проектирование сетей

> Какие серверы, контейнеры, планировщики, устройства, виртуальные локальные сети, брандмауэры и т. Д. Необходимы?

_ (например, '10 виртуальных машин с Ubuntu 14 в AWS IaaS + 2 региона AWS + 2 VPC на регион + Route53 ') _

### Устойчивость, отказоустойчивость (FT) и высокая доступность (HA)

> Как система устойчива к сбоям? Какие механизмы для устранения ошибок реализованы? Как сделать систему / услугу доступной?

_ (например, 2 Active-Active дата-центра в двух городах + два или более узлов на каждом уровне) _

### Регулирование и частичное отключение

> Как можно регулировать или частично отключить систему, например, избежать флудинга других зависимых систем? Можно ли ограничить пропускную способность, скажем, до 100 запросов в секунду? и т. д. Какие существуют схемы отключения соединения?

#### Регулирование и частичное отключение - внешние запросы

_ (например, коммерческий API-шлюз позволяет управлять регулированием) _

#### Регулирование и частичное отключение - внутренние компоненты

_ (например, экспоненциальный откат для всех служб на основе HTTP + конечные точки проверки работоспособности `/health` для всех служб) _

### Ожидаемый трафик и нагрузка

> Сведения об ожидаемой пропускной способности / трафике: объемы вызовов, пиковые периоды, периоды бездействия. Какие факторы влияют на загрузку: заказы, просмотры страниц, количество товаров в корзине и т. Д.

_ (например, макс. 1000 запросов в секунду с 400 одновременными пользователями - пятница с 16:00 до воскресенья @ 18:00, обусловленная вероятностью проведения барбекю по соседству) _

#### Горячие или пиковые периоды

_

#### Теплые периоды

_

#### Прохладные или тихие периоды

_

### Экологические различия сред

> Каковы основные различия между Production / Live и другими средами? Какие вещи, следовательно, не могут быть протестированы в вышестоящих средах?

_ (например, самоподписанные сертификаты HTTPS в Pre-Production - истечение срока действия сертификата может быть неправильно обнаружено в Production) _

### Инструменты

> Какие инструменты доступны, чтобы помочь управлять системой?

_ (например, используйте сценарий `queue-cleardown.sh` для безопасной очистки очереди обработки ночью) _

## Требуемые ресурсы

> Какие ресурсы для вычислений, хранения, базы данных, метрик, ведения журналов и масштабирования необходимы? Каковы минимальные и ожидаемые максимальные размеры (в ядрах ЦП, ОЗУ, дисковом пространстве ГБ, Гбит / с и т. Д.)?

### Требуемые ресурсы - выслительные мощности

_ (например, мин: 4 виртуальных машины с 2 vCPU каждая. Макс: около 40 виртуальных машин) _

### Требуемые ресурсы - хранилище

_ (например, мин. 10 ГБ хранилища BLOB-объектов Azure. Макс .: около 500 ГБ хранилища BLOB-объектов Azure) _

### Требуемые ресурсы - база данных

_ (например, мин. 500 ГБ стандартного уровня RDS. Макс .: около 2 ТБ стандартного RDS уровня) _

### Требуемые ресурсы - метрики

_ (например, мин: 100 метрик на узел в минуту. Макс: около 6000 метрик на узел в минуту) _

### Необходимые ресурсы - логирование

_ (например, мин: 60 строк журнала на узел в минуту (100 КБ). Макс: около 6000 строк журнала на узел в минуту (1 МБ)) _

### Требуемые ресурсы - прочее

_ (например, мин: 10 запросов на шифрование на узел в минуту. Макс.: около 100 запросов на шифрование на узел в минуту) _


## Безопасность и контроль доступа

### Пароль и безопасность PII

> Какая защита предусмотрена для паролей и личной информации (PII)? Хешируются ли пароли с сильной хеш-функцией и засоляются?

_ (например, пароли хешируются 10-символьной солью и SHA265) _

### Постоянные проверки безопасности

> Как система будет контролироваться на предмет безопасности?

_ (например, инструмент ABC выполняет поиск сообщений о проблемах CVE и отчетов через панель управления ABC) _

## Конфигурация системы

### Управление конфигурацией

> Как конфигурация управляется для системы?

_ (например, CloudInit загружает установку Puppet - Puppet затем управляет всей конфигурацией уровня системы и приложения, за исключением службы XYZ, которая настраивается через файлы `App.config` в Subversion) _

### Секреты управления

> Как управляются секреты конфигурации?

_ (например, управление секретами осуществляется с помощью Hashicorp Vault с 3 сниппетами для мастер-ключа) _

## Резервное копирование и восстановление системы

### Требования к резервному копированию

> Какие части системы необходимо сохранить?

_ (например, для резервного копирования требуется только база данных CoreTransactions в PostgreSQL и основная база данных Puppet) _

### Процедуры резервного копирования

> Как происходит резервное копирование? Это влияет на обслуживание? Должна ли система [частично] быть отключена первой?

_ (например, резервное копирование происходит из реплики чтения - на действующую службу это не влияет) _

### Процедуры восстановления

> Как происходит восстановление? Это влияет на обслуживание? Должна ли система [частично] быть отключена первой?

_ (например, служба бронирования должна быть отключена до восстановления, в противном случае транзакции будут потеряны) _

## Мониторинг и оповещение

### Решение для агрегации журналов

> Какое решение для агрегации и поиска журналов будет использовано?

_ (например, система будет использовать существующий внутренний кластер ELK. Ожидается 2000-6000 сообщений в минуту при нормальных уровнях нагрузки) _

### Формат сообщения журнала

> Какой формат сообщения журнала будет использоваться? Структурированная регистрация с JSON? однострочный вывод в стиле `log4j`?

_ (например, сообщения журнала будут использовать однострочный формат, совместимый с log4j, с обернутыми следами стека) _

### События и сообщения об ошибках

> Какие значимые события, переходы состояний и события ошибок могут регистрироваться?

_ (например, идентификаторы 1000-1999: события базы данных; идентификаторы 2000-2999: события шины сообщений; идентификаторы 3000-3999: события действий, инициированные пользователем; ...) _

### Метрики

> Какие значимые показатели будут генерироваться?

_ (например, обычная статистика ВМ (ЦП, диск, потоки и т. д.) + около 200 технических метрик приложения + около 400 метрик уровня пользователя) _

### Проверка здоровья

> Как оценивается состояние зависимостей (компонентов и систем)? Как система сообщает о своем здоровье?

#### Здоровье зависимостей

_ (например, используйте `/health` конечную точку HTTP для внутренних компонентов, которые ее предоставляют. Другие системы и внешние конечные точки: обычно HTTP 200, но некоторые синтетические проверки для некоторых служб) _

#### Здоровье службы

_ (например, укажите конечную точку HTTP `/health`: 200 -> базовое состояние, 500 -> неверная конфигурация +` ​​/health/deps` для проверки зависимостей) _

## Операционные задачи

### Развертывание

> Как развертывается программное обеспечение? Как происходит откат?

_ (например, мы используем GoCD для координации развертываний, запуск Chef, извлекает RPM из внутреннего репозитория yum) _

### Пакетная обработка

> Какой тип пакетной обработки имеет место?

_ (например, файлы передаются через SFTP на медиасервер. Система обрабатывает до 100 таких файлов в час по расписанию cron) _

### Процедуры электропитания

> Что должно произойти, когда машины выключаются?

_ (например, *** ПРЕДУПРЕЖДЕНИЕ: мы еще не исследовали этот сценарий! ***) _

### Регулярные и санитарные проверки

> Какие проверки должны проводиться на регулярной основе?

_ (например, все конечные точки `/health` должны проверяться каждые 60 секунд, плюс искусственные проверки транзакций выполняются каждые 5 минут через Pingdom) _

### Исправление проблем

> Как должно происходить устранение неполадок? Какие инструменты доступны?

_ (например, используйте комбинацию проверок конечной точки `/health` и сценариев` abc - *. sh` для диагностики типичных проблем) _

## Задачи обслуживания

### Установка патчей

> Как следует устанавливать и тестировать патчи?

#### Нормальный цикл патчей

_ (например, используйте стандартный цикл тестирования исправлений ОС вместе с развертыванием через Jenkins и Capistrano) _

#### Уязвимости нулевого дня

_ (например, используйте уведомления раннего предупреждения от развертывания UpGuard plus через Jenkins и Capistrano) _

### Изменение летнего времени

> Влияет ли на программное обеспечение изменение летнего времени (как клиента, так и сервера)?

_ (например, сервер синхронизирует все настроенные на UTC+0. Все данные даты / времени, преобразованные в UTC со смещением перед обработкой) _

### Очистка данных

> Какие данные необходимо очистить? Как часто? Какие инструменты или сценарии контролируют очистку?

_ (например, используйте `abc-cleardown.ps1`, запускаемый ночью, чтобы очистить кэш документов) _

### Ротация журнала

> Нужна ли ротация журналов? Как это контролируется?

_ (например, в журнале событий Windows * ABC Service * установлен максимальный размер 512 МБ) _

## Процедуры восстановления после отказа и восстановления

> Что должно произойти, когда части системы переключаются на резервные системы? Что нужно во время восстановления?

### Аварийное переключение

_

### Восстановление

_

### Устранение неполадок при сбое и восстановлении

> Какие инструменты или сценарии доступны для устранения неполадок при сбое и восстановлении?

_ (например, запустите `SELECT state__desc FROM sys.database__mirroring__endpoints` на узле PRIMARY, а затем используйте сценарии в * db-failover * Git-репо) 
